<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer in LocalStorage</title>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<!-- Include jQuery UI -->
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

</head>
<style>
    body {
        background-color: #f2f2f2;
    }

    .title {
        text-align: center;
	margin: 0 auto;
	margin-bottom: 10px;
        color: white;
	width: 80vw;
        background-color: rgb(0, 153, 204);
    }

    .highlight {
        background-color: green;
        transition: background-color 0.5s ease;
    }

    .task_title {
        background-color: rgb(0, 153, 204);
        font-weight: bolder;
        font-size: large;
    }

    .task_content {
        display: flex;
        background-color: rgb(204, 242, 255);
    }

    .task_content p {
        flex: 1;
        border: 1px solid black;
        text-align: center;
    }
</style>

<body>
    <h1 class="title">Task Manager</h1>
    <label for="tasks">
        Task:
        <input type="text" name="task" id="task">
    </label>
    <button onclick="entryTimer()"> Pause Timer </button>
    <button onclick="regressiveTimer(5, 0, 0)"> 5 minutes </button>
    <button onclick="regressiveTimer(10, 0, 0)"> 10 minutes </button>
    <button onclick="regressiveTimer(20, 0, 0)"> 20 minutes </button>
    <button onclick="regressiveTimer(30, 0, 0)"> 30 minutes </button>
    <button onclick="nifValidator()"> validate nif </button>
    <button onclick="downloadMolokai()"> Download molokai</button>
    <div id="timerData"></div>
</body>
<script>
    let timer_start = new Date();
    let estimated = 0;
    // Function to highlight the input when saved task
    function highlightInput() {
        let input = document.getElementById("task");
        input.classList.add("highlight");
        setTimeout(() => {
            input.classList.remove("highlight");
        }, 500);
    }

    // Function to validate nif received through the field of task
    function nifValidator() {
	let nif = document.getElementById("task").value;
	let letters = ["T","R","W","A","G","M","Y","F","P","D","X","B","N","J","Z","S","Q","V","H","L","C","K","E"];
	if (nif.toUpperCase() == nif.substring(0,8)+letters[parseInt(nif.substring(0,8)) % 23]) alert("NIF OK.")
	else alert("NIF not OK, please check the letter is written in uppercase.");
    }

    // Function to retrieve to a web page to regressive Counter
    function regressiveTimer(minutes, seconds, hour) {
	 estimated = minutes;
	 window.open("https://e.ggtimer.com/"+hour+"hour"+minutes+"minutes"+seconds+"seconds");
    }

    // Function to enter the data of timer into localStorage
    function entryTimer() {
        highlightInput();
        let key = "timer";
        let timer_end = new Date();
        let tmpTime;
        let timer = localStorage.getItem(key);

        if (!timer) {
            tmpTime = [{
                "start_time": timer_start,
                "end_time": timer_end,
                "wasted": `seconds wasted: ${(timer_end - timer_start) / 1000}`,
                "task": document.getElementById("task").value,
                "estimated_time": estimated
            }];
            localStorage.setItem(key, JSON.stringify(tmpTime));
        } else {
            tmpTime = {
                "start_time": timer_start,
                "end_time": timer_end,
                "wasted": `seconds wasted: ${(timer_end - timer_start) / 1000}`,
                "task": document.getElementById("task").value,
                "estimated_time": estimated
            };
            let tmp = JSON.parse(timer);
            tmp.unshift(tmpTime);
            localStorage.setItem(key, JSON.stringify(tmp));
        }

        timer_start = new Date();
        displayTimerData();
    }

    // Function to display the timer data in the screen
    function displayTimerData() {
        let key = "timer";
        let timerData = JSON.parse(localStorage.getItem(key));
        let timerDataContainer = document.getElementById("timerData");
        timerDataContainer.innerHTML = ""; // Clear previous content

        if (timerData) {
            timerData.forEach(data => {
                let div = document.createElement("div");
                let minutes = (parseFloat(data.wasted.split(':')[1]) / 60);
                let hours = (parseFloat(data.wasted.split(':')[1]) / 3600);
                div.innerHTML = `
                        <p class='task_title'>Task: ${data.task}</p>
                        <div class='task_content'>
                        <p>Start Time: ${data.start_time}</p>
                        <p>End Time: ${data.end_time}</p>
                        <p>Wasted Time In Seconds: ${data.wasted.split(':')[1]}</p>
                        <p>Wasted Time In Minutes: ${minutes}</p>
                        <p>Wasted Time In Hours: ${hours}</p>
                        <p>Estimated time in minutes: ${data.estimated_time}</p>
                        <p>Wasted Time <br> Hours: ${Math.trunc(hours)} Minutes: ${Math.trunc(minutes - (Math.trunc(hours) * 60))}</p>
                        </div>
                        <hr>
                    `;
                timerDataContainer.appendChild(div);
            });
        }
    }

    function downloadMolokai(){
	navigator.clipboard.writeText("curl -G https://raw.githubusercontent.com/tomasr/molokai/master/colors/molokai.vim -o molokai.vim\ncp monokai.vim colors")
    }

    // Initial display on page load
    displayTimerData();
$(document).ready(function(){
        $('button').button();
    });
</script>

</html>
